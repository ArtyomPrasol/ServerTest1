#include <iostream>
#include <fstream>
#include <windows.h>
using namespace std;
#include <string>

struct Student
{
	char Name;
	int val[4];
}B;

int size_pred;
int answer;

int main() {
	ifstream fR;
	ofstream fA;
	string nameR ="D:\Work\WWW\Server\REQUEST.bin";
	string nameA ="D:\Work\WWW\Server\ANSWER.bin";

	cout << "server is working" << endl;

	fR.open(nameR, ios::binary);
	fR.seekg(0, ios::end);
	size_pred = fR.tellg();
	fR.close();

	while (true)
	{
		fR.open(nameR, ios::binary);
		fR.seekg(0, ios::end);
		while (size_pred >= fR.tellg()) {
			Sleep(100);
			fR.seekg(0,ios::end);
		}
		fR.seekg(size_pred, ios::beg);
		fR.read((char*)&B, sizeof(B));
		size_pred = fR.tellg();
		fR.close();
		 
		answer = 60000;
		for (int i = 0; i < 4; i++)
		{
			int Cl = B.val[i];
			switch (Cl)
			{
			case 5: if (answer%10000>=5) answer = 50000;
				
				break;
			case 4: if (answer % 10000 >= 4) answer = 40000;
				
				break;
			case 3: if (answer % 10000 >= 3) answer = 30000;
				
				break;
			case 2: if (answer % 10000 >= 2)
				answer = answer + pow(10, i);
				break;
			}
		}
		fA.open(nameA, ios::binary | ios::app);
		fA.write((char*)&answer, sizeof(answer));
		fA.close();
	}
	return 0;
}
